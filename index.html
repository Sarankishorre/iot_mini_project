<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Parking Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { 
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      line-height: 1.6;
    }
    
    .parking-bg {
      background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.4)), 
                  url('car-park-with-cars-background_1047188-62547.avif'),
                  linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-size: cover, cover;
      background-position: center, center;
      background-attachment: fixed, fixed;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
    }
    
    body { 
      font-family: 'Inter', sans-serif; 
      overflow: hidden;
      margin: 0;
      padding: 0;
      height: 100vh;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 193, 7, 0.3);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
    }
    
    .text-shadow {
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    
    .text-shadow-light {
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }
    
    .slot-card {
      align-items: center; 
      justify-content: center;
      display: flex;
      flex-direction: column;
      padding: 20px;
      height: 140px;
      width: 140px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      font-weight: 600;
      font-size: 14px;
    }
    
    .slot-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    }
    
    .slot-available {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }
    
    .slot-occupied {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }
    
    .slot-reserved {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
    }
    
    .booking-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .booking-modal.active {
      display: flex;
    }
    
    .timer-display {
      font-family: 'Courier New', monospace;
      font-size: 18px;
      font-weight: bold;
      color: #dc2626;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 12px;
      border-radius: 8px;
      border: 2px solid #ef4444;
    }
    
    .payment-option {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .payment-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    
    .payment-option.selected {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
    }
    
    .feature-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 16px;
      transition: all 0.3s ease;
    }
    
    .feature-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    
    .stats-number {
      font-size: 2.5rem;
      font-weight: 800;
      line-height: 1;
    }
    
    .stats-label {
      font-size: 0.875rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
  </style>
</head>

<body class="parking-bg">
<div class="min-h-screen p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-5xl font-bold text-white drop-shadow-lg">Smart Parking Dashboard</h1>
    <div class="flex items-center gap-4">
      <div class="glass-card px-6 py-3 rounded-xl text-gray-800 font-semibold">
        <span id="userDisplay">Guest User</span>
      </div>
      <button onclick="logout()" class="bg-red-500/80 hover:bg-red-600/80 text-white px-6 py-3 rounded-xl transition font-semibold">
        Logout
      </button>
    </div>
  </div>

  <!-- Additional Features -->
  <div class="grid grid-cols-4 gap-4 mb-8">
    <div class="feature-card text-white">
      <div class="flex items-center gap-3">
        <i class="fas fa-clock text-2xl text-blue-300"></i>
        <div>
          <p class="text-sm opacity-80">Current Time</p>
          <p class="font-semibold text-lg" id="currentTime">--:--</p>
        </div>
      </div>
    </div>
    <div class="feature-card text-white">
      <div class="flex items-center gap-3">
        <i class="fas fa-calendar text-2xl text-green-300"></i>
        <div>
          <p class="text-sm opacity-80">Today</p>
          <p class="font-semibold text-lg" id="currentDate">--</p>
        </div>
      </div>
    </div>
    <div class="feature-card text-white">
      <div class="flex items-center gap-3">
        <i class="fas fa-coins text-2xl text-yellow-300"></i>
        <div>
          <p class="text-sm opacity-80">Today's Revenue</p>
          <p class="font-semibold text-lg">₹1,250</p>
        </div>
      </div>
    </div>
    <div class="feature-card text-white">
      <div class="flex items-center gap-3">
        <i class="fas fa-chart-line text-2xl text-purple-300"></i>
        <div>
          <p class="text-sm opacity-80">Occupancy Rate</p>
          <p class="font-semibold text-lg">37.5%</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="grid grid-cols-12 gap-6">
    
    <!-- Left Side - Parking Slots -->
    <div class="col-span-8">
      <div class="glass-card rounded-3xl p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Parking Slots</h2>
        
        <!-- Slot Grid -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="slot-card slot-available" onclick="bookSlot('A1')" data-slot="A1">
            <i class="fas fa-car text-3xl mb-2"></i>
            <p class="font-semibold">A1</p>
            <p class="text-sm opacity-80">Available</p>
          </div>
          
          <div class="slot-card slot-occupied" data-slot="A2">
            <i class="fas fa-car text-3xl mb-2"></i>
            <p class="font-semibold">A2</p>
            <p class="text-sm opacity-80">Occupied</p>
          </div>
          
          <div class="slot-card slot-available" onclick="bookSlot('A3')" data-slot="A3">
            <i class="fas fa-car text-3xl mb-2"></i>
            <p class="font-semibold">A3</p>
            <p class="text-sm opacity-80">Available</p>
          </div>
          
          <div class="slot-card slot-reserved" data-slot="A4">
            <i class="fas fa-car text-3xl mb-2"></i>
            <p class="font-semibold">A4</p>
            <p class="text-sm opacity-80">Reserved</p>
          </div>
          
          <div class="slot-card slot-available" onclick="bookSlot('B1')" data-slot="B1">
            <i class="fas fa-car text-3xl mb-2"></i>
            <p class="font-semibold">B1</p>
            <p class="text-sm opacity-80">Available</p>
          </div>
          
          <div class="slot-card slot-available" onclick="bookSlot('B2')" data-slot="B2">
            <i class="fas fa-car text-3xl mb-2"></i>
            <p class="font-semibold">B2</p>
            <p class="text-sm opacity-80">Available</p>
          </div>
          
          <div class="slot-card slot-occupied" data-slot="B3">
            <i class="fas fa-car text-3xl mb-2"></i>
            <p class="font-semibold">B3</p>
            <p class="text-sm opacity-80">Occupied</p>
          </div>
          
          <div class="slot-card slot-available" onclick="bookSlot('B4')" data-slot="B4">
            <i class="fas fa-car text-3xl mb-2"></i>
            <p class="font-semibold">B4</p>
            <p class="text-sm opacity-80">Available</p>
          </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="grid grid-cols-3 gap-4">
          <div class="bg-green-100 p-6 rounded-xl text-center">
            <p class="stats-number text-green-700">5</p>
            <p class="stats-label text-green-600">Available</p>
          </div>
          <div class="bg-red-100 p-6 rounded-xl text-center">
            <p class="stats-number text-red-700">2</p>
            <p class="stats-label text-red-600">Occupied</p>
          </div>
          <div class="bg-yellow-100 p-6 rounded-xl text-center">
            <p class="stats-number text-yellow-700">1</p>
            <p class="stats-label text-yellow-600">Reserved</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Right Side - Booking Info -->
    <div class="col-span-4">
      <div class="glass-card rounded-3xl p-6 mb-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Active Booking</h2>
        <div id="activeBooking" class="space-y-4">
          <div class="text-center text-gray-500 py-8">
            <i class="fas fa-parking text-4xl mb-2"></i>
            <p>No active booking</p>
          </div>
        </div>
      </div>
      
      <div class="glass-card rounded-3xl p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Recent Bookings</h2>
        <div id="recentBookings" class="space-y-3">
          <div class="bg-gray-100 p-3 rounded-xl">
            <div class="flex justify-between items-center">
              <div>
                <p class="font-semibold">A1</p>
                <p class="text-sm text-gray-500">2 hours ago</p>
              </div>
              <p class="font-bold text-green-600">₹100</p>
            </div>
          </div>
          <div class="bg-gray-100 p-3 rounded-xl">
            <div class="flex justify-between items-center">
              <div>
                <p class="font-semibold">B2</p>
                <p class="text-sm text-gray-500">5 hours ago</p>
              </div>
              <p class="font-bold text-green-600">₹150</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Booking Modal -->
<div id="bookingModal" class="booking-modal">
  <div class="glass-card rounded-3xl p-8 max-w-lg w-full mx-4">
    <h3 class="text-3xl font-bold text-gray-800 mb-6">Book Parking Slot</h3>
    
    <form id="bookingForm" class="space-y-5">
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Slot Number</label>
        <input type="text" id="slotNumber" readonly class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-xl font-semibold">
      </div>
      
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Duration</label>
        <select id="duration" class="w-full px-4 py-3 bg-white border border-gray-300 rounded-xl">
          <option value="1">1 hour - ₹50</option>
          <option value="2">2 hours - ₹100</option>
          <option value="3">3 hours - ₹150</option>
          <option value="4">4 hours - ₹200</option>
          <option value="8">8 hours - ₹400</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Vehicle Number</label>
        <input type="text" id="vehicleNumber" placeholder="Enter vehicle number" class="w-full px-4 py-3 bg-white border border-gray-300 rounded-xl">
      </div>
      
      <!-- Payment Gateway Options -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-3">Payment Method</label>
        <div class="grid grid-cols-2 gap-3">
          <div class="payment-option bg-white border-2 border-gray-300 rounded-xl p-3" onclick="selectPayment('card')">
            <div class="flex items-center gap-2">
              <i class="fas fa-credit-card text-blue-500"></i>
              <span class="font-medium">Credit Card</span>
            </div>
          </div>
          <div class="payment-option bg-white border-2 border-gray-300 rounded-xl p-3" onclick="selectPayment('upi')">
            <div class="flex items-center gap-2">
              <i class="fas fa-mobile-alt text-green-500"></i>
              <span class="font-medium">UPI</span>
            </div>
          </div>
          <div class="payment-option bg-white border-2 border-gray-300 rounded-xl p-3" onclick="selectPayment('wallet')">
            <div class="flex items-center gap-2">
              <i class="fas fa-wallet text-purple-500"></i>
              <span class="font-medium">Wallet</span>
            </div>
          </div>
          <div class="payment-option bg-white border-2 border-gray-300 rounded-xl p-3" onclick="selectPayment('cash')">
            <div class="flex items-center gap-2">
              <i class="fas fa-money-bill text-yellow-500"></i>
              <span class="font-medium">Cash</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="flex gap-4">
        <button type="button" onclick="closeBookingModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-xl hover:bg-gray-400 transition font-semibold">
          Cancel
        </button>
        <button type="submit" class="flex-1 bg-blue-500 text-white py-3 rounded-xl hover:bg-blue-600 transition font-semibold">
          Proceed to Payment
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // Parking slots data
  let parkingSlots = {
    'A1': { status: 'available', bookedBy: null, duration: null },
    'A2': { status: 'occupied', bookedBy: 'demo_user', duration: 2 },
    'A3': { status: 'available', bookedBy: null, duration: null },
    'A4': { status: 'reserved', bookedBy: 'demo_user', duration: 3 },
    'B1': { status: 'available', bookedBy: null, duration: null },
    'B2': { status: 'available', bookedBy: null, duration: null },
    'B3': { status: 'occupied', bookedBy: 'demo_user', duration: 1 },
    'B4': { status: 'available', bookedBy: null, duration: null }
  };
  
  let currentUser = null;
  let activeBooking = null;
  let selectedPaymentMethod = null;
  let reservationTimers = {};
  
  // Update current time and date
  function updateDateTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-US', { 
      hour: '2-digit', 
      minute: '2-digit',
      hour12: true 
    });
    const dateString = now.toLocaleDateString('en-US', { 
      weekday: 'short', 
      month: 'short', 
      day: 'numeric' 
    });
    
    document.getElementById('currentTime').textContent = timeString;
    document.getElementById('currentDate').textContent = dateString;
  }
  
  // Start timer for reservation
  function startReservationTimer(slotId, duration) {
    const endTime = new Date().getTime() + (duration * 60 * 60 * 1000);
    
    reservationTimers[slotId] = setInterval(() => {
      const now = new Date().getTime();
      const timeLeft = endTime - now;
      
      if (timeLeft <= 0) {
        clearInterval(reservationTimers[slotId]);
        releaseSlot(slotId);
        showNotification(`Reservation for ${slotId} has expired!`, 'error');
        return;
      }
      
      const hours = Math.floor(timeLeft / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
      
      // Update timer display if this slot is active booking
      const activeBookingEl = document.getElementById('activeBooking');
      const timerEl = document.getElementById(`timer-${slotId}`);
      if (timerEl) {
        timerEl.textContent = `${hours}h ${minutes}m ${seconds}s`;
      }
    }, 1000);
  }
  
  // Payment gateway selection
  function selectPayment(method) {
    selectedPaymentMethod = method;
    
    // Remove selected class from all options
    document.querySelectorAll('.payment-option').forEach(option => {
      option.classList.remove('selected');
    });
    
    // Add selected class to clicked option
    event.currentTarget.classList.add('selected');
  }
  
  // Process payment
  function processPayment(amount, method) {
    return new Promise((resolve) => {
      // Simulate payment processing
      setTimeout(() => {
        showNotification(`Payment of ₹${amount} processed via ${method.toUpperCase()}!`, 'success');
        resolve(true);
      }, 2000);
    });
  }
  
  // Check user session
  window.addEventListener('load', function() {
    const userData = localStorage.getItem('currentUser');
    if (userData) {
      currentUser = JSON.parse(userData);
      document.getElementById('userDisplay').textContent = currentUser.username;
      updateActiveBooking();
      updateDateTime();
      setInterval(updateDateTime, 1000);
    } else {
      window.location.href = 'login.html';
    }
  });
  
  // Logout function
  function logout() {
    localStorage.removeItem('currentUser');
    window.location.href = 'login.html';
  }
  
  // Book slot
  function bookSlot(slotId) {
    if (!currentUser) {
      alert('Please login to book a slot');
      return;
    }
    
    const slot = parkingSlots[slotId];
    if (slot.status !== 'available') {
      alert('This slot is not available');
      return;
    }
    
    document.getElementById('slotNumber').value = slotId;
    document.getElementById('bookingModal').classList.add('active');
  }
  
  // Close booking modal
  function closeBookingModal() {
    document.getElementById('bookingModal').classList.remove('active');
    document.getElementById('bookingForm').reset();
    selectedPaymentMethod = null;
    
    // Remove selected class from all payment options
    document.querySelectorAll('.payment-option').forEach(option => {
      option.classList.remove('selected');
    });
  }
  
  // Handle booking form submission
  document.getElementById('bookingForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!selectedPaymentMethod) {
      showNotification('Please select a payment method', 'error');
      return;
    }
    
    const slotId = document.getElementById('slotNumber').value;
    const duration = parseInt(document.getElementById('duration').value);
    const vehicleNumber = document.getElementById('vehicleNumber').value;
    const amount = duration * 50;
    
    // Process payment first
    const paymentSuccess = await processPayment(amount, selectedPaymentMethod);
    
    if (paymentSuccess) {
      // Book the slot
      parkingSlots[slotId] = {
        status: 'occupied',
        bookedBy: currentUser.username,
        duration: duration,
        vehicleNumber: vehicleNumber,
        bookingTime: new Date().toISOString(),
        paymentMethod: selectedPaymentMethod,
        amount: amount
      };
      
      // Start reservation timer
      startReservationTimer(slotId, duration);
      
      // Update UI
      updateSlotUI(slotId);
      updateActiveBooking();
      closeBookingModal();
      
      // Show success message
      showNotification(`Slot ${slotId} booked successfully! Timer started.`, 'success');
    }
  });
  
  // Update slot UI
  function updateSlotUI(slotId) {
    const slotElement = document.querySelector(`[data-slot="${slotId}"]`);
    const slot = parkingSlots[slotId];
    
    slotElement.className = `slot-card slot-${slot.status}`;
    if (slot.status === 'occupied') {
      slotElement.onclick = null;
      slotElement.innerHTML = `
        <i class="fas fa-car text-3xl mb-2"></i>
        <p class="font-semibold">${slotId}</p>
        <p class="text-sm opacity-80">Occupied</p>
      `;
    }
  }
  
  // Update active booking
  function updateActiveBooking() {
    const activeBookingEl = document.getElementById('activeBooking');
    const userBookings = Object.entries(parkingSlots).filter(([id, slot]) => 
      slot.bookedBy === currentUser.username && slot.status === 'occupied'
    );
    
    if (userBookings.length > 0) {
      const [slotId, slot] = userBookings[0];
      activeBookingEl.innerHTML = `
        <div class="bg-green-100 p-4 rounded-xl">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold text-green-700">Active Booking</span>
            <span class="text-sm text-green-600">${slotId}</span>
          </div>
          <div class="text-sm text-gray-600 mb-3">
            <p>Vehicle: ${slot.vehicleNumber}</p>
            <p>Duration: ${slot.duration} hours</p>
            <p>Payment: ${slot.paymentMethod?.toUpperCase() || 'N/A'}</p>
            <p>Amount: ₹${slot.amount || 'N/A'}</p>
            <p>Time: ${new Date(slot.bookingTime).toLocaleTimeString()}</p>
          </div>
          <div class="timer-display mb-3" id="timer-${slotId}">
            Loading timer...
          </div>
          <button onclick="releaseSlot('${slotId}')" class="bg-red-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-red-600 transition">
            Release Slot
          </button>
        </div>
      `;
      
      // Start timer if not already running
      if (!reservationTimers[slotId]) {
        startReservationTimer(slotId, slot.duration);
      }
    } else {
      activeBookingEl.innerHTML = `
        <div class="text-center text-gray-500 py-8">
          <i class="fas fa-parking text-4xl mb-2"></i>
          <p>No active booking</p>
        </div>
      `;
    }
  }
  
  // Release slot
  function releaseSlot(slotId) {
    // Clear timer if exists
    if (reservationTimers[slotId]) {
      clearInterval(reservationTimers[slotId]);
      delete reservationTimers[slotId];
    }
    
    parkingSlots[slotId] = {
      status: 'available',
      bookedBy: null,
      duration: null,
      vehicleNumber: null,
      bookingTime: null,
      paymentMethod: null,
      amount: null
    };
    
    const slotElement = document.querySelector(`[data-slot="${slotId}"]`);
    slotElement.className = 'slot-card slot-available';
    slotElement.onclick = () => bookSlot(slotId);
    slotElement.innerHTML = `
      <i class="fas fa-car text-3xl mb-2"></i>
      <p class="font-semibold">${slotId}</p>
      <p class="text-sm opacity-80">Available</p>
    `;
    
    updateActiveBooking();
    showNotification(`Slot ${slotId} released successfully!`, 'success');
  }
  
  // Show notification
  function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-6 py-3 rounded-xl text-white z-50 ${
      type === 'success' ? 'bg-green-500' : 'bg-red-500'
    }`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
</script>

</body>
</html>